# Cross-platform set of build steps for building esy projects

steps:
  - script: npm install -g esy@0.5.6
    displayName: 'npm install -g esy@0.5.6'
  - script: esy
    displayName: 'esy install & build'

  # Run tests
  - bash: ./runtests.sh

  - bash: mkdir -p rls-release
  - bash: |
    esy cp-bin
    mv bin.exe rls-release/reason-language-server.exe
  - task: PublishBuildArtifacts@1
    displayName: 'Upload binary'
    inputs:
        pathToPublish: 'rls-release'
        artifactName: 'rls-$(Agent.OS)'
        parallel: true
        parallelCount: 8
